var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _objectSpread2=_interopRequireDefault(require("@babel/runtime/helpers/objectSpread2"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var proxied=global.XMLHttpRequest?global.XMLHttpRequest.prototype.open:function(){};var currentId=0;var Network=function(){function Network(){(0,_classCallCheck2.default)(this,Network);this.requests=[];this.listeners=[];this.get=this.get.bind(this);}(0,_createClass2.default)(Network,[{key:"listen",value:function listen(fn){this.listeners.push(fn);fn(this.requests);}},{key:"get",value:function get(){return this.requests;}},{key:"unlisten",value:function unlisten(fn){this.listeners=this.listeners.filter(function(l){return l!==fn;});}},{key:"clear",value:function clear(){var _this=this;this.requests=[];this.listeners.forEach(function(l){return l(_this.requests);});}},{key:"addRequest",value:function addRequest(id,request){var _this2=this;var index=this.requests.findIndex(function(req){return req.id===id;});if(index>=0){this.requests[index]=(0,_objectSpread2.default)({id:id},request);}else{this.requests.push((0,_objectSpread2.default)({id:id},request));}this.listeners.forEach(function(l){return l(_this2.requests);});}},{key:"attach",value:function attach(){var me=this;var headers={};global.XMLHttpRequest.prototype.open=function proxyOpen(){var _this3=this;for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}var sendArgs;var method=args[0],url=args[1];var id=currentId++;this.addEventListener('load',function(){me.addRequest(id,{url:url,method:method,args:sendArgs,headers:headers,requestHeaders:_this3.getAllResponseHeaders(),contentType:_this3.getResponseHeader('content-type')||'',request:_this3,status:_this3.status||null});});this.addEventListener('error',function(error){me.addRequest(id,{url:url,method:method,error:error,args:sendArgs,headers:headers,requestHeaders:_this3.getAllResponseHeaders(),request:_this3,status:_this3.status||'Error'});});var proxiedSend=this.send;var proxiedSetRequestHeader=this.setRequestHeader;this.send=function proxySend(){for(var _len2=arguments.length,sendargs=new Array(_len2),_key2=0;_key2<_len2;_key2++){sendargs[_key2]=arguments[_key2];}sendArgs=sendargs;me.addRequest(id,{url:url,method:method,args:sendArgs,headers:headers,request:this,status:'Waiting'});return proxiedSend.apply(this,[].slice.call(arguments));};this.setRequestHeader=function(name,value){headers[name]=value;return proxiedSetRequestHeader.apply(this,[].slice.call(arguments));};return proxied.apply(this,[].slice.call(arguments));};}},{key:"detach",value:function detach(){global.XMLHttpRequest.prototype.open=proxied;}}]);return Network;}();var network=new Network();var _default=network;exports.default=_default;